define("pages/apply",function(e){function t(e){var t={maxNum:3,action:n(".img_up_action"),par:n(".img_up_list"),item:n(".img_up_item"),input:n("input[type=hidden]"),url:""};this.opt=n.extend({},t,e),this.opt.action=this.opt.par.find(this.opt.action)}function i(){m&&("none"===g[0].style.display?m.setItem("queryTip","no"):m.setItem("queryTip","yes"))}var n=e("Zepto"),a=e("wechat"),o=e("form"),a=e("wechat"),s=e("alertShow"),s=e("alertShow"),r={getVer:function(){var e=navigator.userAgent,t=/MicroMessenger\/\s?(\d)\.(\d)\.?(\d)?/.exec(e)?/MicroMessenger\/\s?(\d)\.(\d)\.?(\d)?/.exec(e):[];if(t.length<2)return"";for(var i="",n=1;n<t.length;n++)i+=t[n]+".";return i=i.substring(0,i.length-1)},init:function(){var e=this,t=e.getVer(),i=t.split("."),a=[6,0,2];n.each(i,function(t,i){return parseInt(i)<parseInt(a[t])?(e.verTip(),!1):parseInt(i)>parseInt(a[t])?!1:void 0})},verTip:function(){s(n.android?"最新版微信才支持神灯房产呢，快去升级吧！":"最新版微信才支持神灯房产呢，快去升级吧！")}};r.init(),n("body").off("touchend",".img_up_item img").on("touchend",".img_up_item img",function(e){if(e.stopPropagation(),!n(this).parent().hasClass("loading_item")&&e.target!=n(this).parent().find(".upload_delete")[0]){var t=this.src,i=[],o=n("body").find("img");o.each(function(e,t){i.push(t.src)});var s={current:t,urls:i},r=jssdk(),l=n.extend({},s,r);a.previewImage(l)}}),t.prototype={constructor:t,imgUpCount:function(){var e=this.opt.maxNum,t=this.opt.par.find(this.opt.item.selector),i=t.length,n=this.opt.action;i>=e?n.hide():n.show(),this.setVal()},setVal:function(){var e=this.opt.par.parent().find(this.opt.input.selector);if(e.length){var t=this.opt.par.find(this.opt.item.selector),i={};t.each(function(e,t){n(t).hasClass("loading_item")||(i[e]=n(t).find("img").attr("url"))});var a=JSON.stringify(i);e.val("{}"===a?"":a),e.change()}},imgUpload:function(){function e(){var o={localId:localIds[t],success:function(a){var o=a.serverId;n.ajax({url:i.opt.url,type:"post",data:{mediaid:o,M_TOKEN:M_TOKEN},dataType:"json",success:function(a){if(2e6==a.retcode){var o='<li><div class="img_up_item" style="background:url(/wechat/accessimg/?url='+a.url+"&M_TOKEN="+M_TOKEN+') center center;background-size:cover;"><a href="javascript:void(0);" class="upload_delete" title="删除"></a><img src="/wechat/accessimg/?url='+a.url+"&M_TOKEN="+M_TOKEN+'" url="'+a.url+'" class="upload_image" /><br></div></li>';n(o).insertBefore(i.opt.action),i.imgUpCount(),++t<localIds.length&&e()}else s(a.msg),++t<localIds.length&&e()},error:function(){s("网络故障，请稍后重试！"),++t<localIds.length&&e()}})},fail:function(){s("上传失败")}};upoptions=n.extend({},o,l),a.uploadImage(upoptions)}if("undefined"==typeof localIds)s("请先选择图片!");else{var t=0,i=this;e()}},imgChoose:function(){var e=this,t={success:function(t){var i=e.opt.maxNum-e.opt.par.find(e.opt.item.selector).length;return t.localIds.length>i?void s("最多可上传"+e.opt.maxNum+"张照片！请重新选择"):(window.localIds=t.localIds,void e.imgUpload())},fail:function(){s("选择图片失败")}},i=n.extend({},t,l);a.chooseImage(i)},imgDel:function(e){e.remove(),this.imgUpCount()}};var l=jssdk();wx.ready(function(){n("body").on("touchend",".img_up_action",function(){r.init();var e=n(this).parents(".img_up_list");new t({maxNum:parseInt(e.attr("data-maxNum")),action:n(this).parent(),par:e,item:n(".img_up_item"),url:"/wechat/upload/"}).imgChoose()}),n("body").on("touchend",".upload_delete",function(){var e=n(this).parents("li"),i=n(this).parents(".img_up_list");new t({maxNum:parseInt(i.attr("data-maxNum")),action:i.find(".img_up_action").parent(),par:i,item:n(".img_up_item"),url:"/wechat/upload/"}).imgDel(e)})}),n("body").off("touchend",".img_up_item img").on("touchend",".img_up_item img",function(e){if(e.stopPropagation(),!n(this).parent().hasClass("loading_item")&&e.target!=n(this).parent().find(".upload_delete")[0]){var t=this.src,i=[],o=n("body").find("img");o.each(function(e,t){i.push(t.src)});var s={current:t,urls:i},r=jssdk(),l=n.extend({},s,r);a.previewImage(l)}});var s=(e("dialog"),e("alertShow")),c=e("validate"),u=e("getData"),d=e("postData"),p=e("fastclick");o.check(),n().ready(function(){var e=n(".query-modal"),t=(n(window).height()-e.height())/2;e.css("margin-top",t-20)});var m=window.localStorage;m&&("no"===m.getItem("queryTip")||location.search.indexOf("notTip")>-1?n(".query-mask").css("display","none"):n(".query-mask").css("display","")),n("#agent").on("change click",function(){var e=n(".item_org"),t=n(".item_agent"),i=n("input[name=type]");"2"==this.selectedOptions[0].value?(e.removeClass("hidden"),t.addClass("hidden"),e.find("input")[0].setAttribute("require",!0),t.find("input").removeAttr("require"),i.val(2)):(t.removeClass("hidden"),e.addClass("hidden"),t.find("input")[0].setAttribute("require",!0),e.find("input").removeAttr("require"),i.val(1))}),n("#loanInfoBtn").on("click",function(){if(!n(this).hasClass("gray")&&!this.clicked){var e=c(n("#apy_tab1").find("input[data-validate]"));if(e===!1)return void n(this).attr("data-check",!1);var t=n('input[name="loanname"]').val(),i=n('input[name="money"]').val();if(t&&t.length>10)return void s("贷款人姓名不能超过十个字");if(!i)return void s("贷款金额不能为空");var a=parseFloat(i);if(50>a||a>2500||i.indexOf(".")>-1)return void s("贷款金额（万元）必须为50~2500的整数！");var o=u(n("#apy_tab1"));o.M_TOKEN=M_TOKEN,this.clicked=!0;var r=this;d({elm:r,data:o,success:function(e,t,i){console.log(t,i.getAllResponseHeaders().toLowerCase()),2e6==e.retcode?(n("input[name=age]").val(e.age),n("input[name=gender]").val(e.gender),n("#apy_tab2").show().siblings(".apy_tab").hide()):s(e.msg)}})}}),n("#sequenceSel").on("change",function(){setTimeout(function(){var e=n("input[name=sequencemoney]"),t=parseInt(n("#sequenceSel").val());console.log("sequence:"+t),2==t?(e[0].setAttribute("require",!0),n(".sequence").show()):(e.removeAttr("require"),e.val("0"),n(".sequence").hide())},0)});var h=n(".loading-mask");n("#houseInfoBtn").on("click",function(){if(!this.clicked&&!n(this).hasClass("gray")){this.clicked=!0;var e=parseInt(n("#sequenceSel").val()),t=parseInt(n('input[name="sequencemoney"]').val());if(2==e&&!t)return void s("一抵金额不能为空");if(n(".imgsIpt").length&&n(".loading_item").length)return void s("图片正在上传中，请稍后再试");var i=u(n("body")),a=n("#house_num_type").val();i.housenum=2==a?n(".hn1").val().trim()+"("+n(".hn2").val().trim()+")"+n(".hn3").val().trim()+"不动产权第"+n(".hn4").val().trim()+"号":n(".ipt_s1").val().trim()+"京房权证"+n(".ipt_s2").val().trim()+"字第"+n(".ipt_s3").val().trim()+"号",i.M_TOKEN=M_TOKEN,i.reqFlowNo=reqFlowNo,i.city=0,h.removeClass("dn");var o=this;d({elm:o,data:i,success:function(e){h.addClass("dn"),2e6==e.retcode?e.isblack?s(e.msg||"此借款人不符合准入条件",function(){wx&&wx.closeWindow()}):(o.clicked=!0,window.location.href="/wechat/succ/?lid="+e.lid):s(e.msg||"网络繁忙")},error:function(){h.addClass("dn")},complete:function(){h.addClass("dn")}})}}),n("#house_num_type").on("change",function(){var e=n(this).val(),t=n(".hn_item_new"),i=n(".hn_item_old");1==e?(i.show(),t.hide(),i.find(".ipt_s3")[0].setAttribute("require",!0),t.find(".hn4")[0].removeAttribute("require"),i.find(".ipt_s3").trigger("change"),t.find(".hn4").trigger("change")):2==e&&(t.show(),i.hide(),i.find(".ipt_s3")[0].removeAttribute("require"),t.find(".hn4")[0].setAttribute("require",!0),i.find(".ipt_s3").trigger("change"),t.find(".hn4").trigger("change"))});var g=n(".nomore img");n("#nomore").on("click",function(){var e=g[0].style.display;"none"===e?(g[0].style.display="",g[1].style.display="none"):(g[0].style.display="none",g[1].style.display=""),"none"===g[0].style.display}),n("#goSubmit").on("click",function(){n(".query-mask").css("display","none"),i()}),n("#goQuery").on("click",function(){i(),window.location.href="/wechat/query/#!/inputInfos"}),p(document.body)});