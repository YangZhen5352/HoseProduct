define("pages/suggestion",function(t){function i(t){var i={maxNum:3,action:n(".img_up_action"),par:n(".img_up_list"),item:n(".img_up_item"),input:n("input[type=hidden]"),url:""};this.opt=n.extend({},i,t),this.opt.action=this.opt.par.find(this.opt.action)}function e(){n("#text").val()&&n(".ipt_text").val()?n("#submit").removeClass("gray"):n("#submit").addClass("gray")}var n=t("Zepto"),a=t("wechat"),a=t("wechat"),o=t("alertShow"),o=t("alertShow"),s={getVer:function(){var t=navigator.userAgent,i=/MicroMessenger\/\s?(\d)\.(\d)\.?(\d)?/.exec(t)?/MicroMessenger\/\s?(\d)\.(\d)\.?(\d)?/.exec(t):[];if(i.length<2)return"";for(var e="",n=1;n<i.length;n++)e+=i[n]+".";return e=e.substring(0,e.length-1)},init:function(){var t=this,i=t.getVer(),e=i.split("."),a=[6,0,2];n.each(e,function(i,e){return parseInt(e)<parseInt(a[i])?(t.verTip(),!1):parseInt(e)>parseInt(a[i])?!1:void 0})},verTip:function(){o(n.android?"最新版微信才支持神灯房产呢，快去升级吧！":"最新版微信才支持神灯房产呢，快去升级吧！")}};s.init(),n("body").off("touchend",".img_up_item img").on("touchend",".img_up_item img",function(t){if(t.stopPropagation(),!n(this).parent().hasClass("loading_item")&&t.target!=n(this).parent().find(".upload_delete")[0]){var i=this.src,e=[],o=n("body").find("img");o.each(function(t,i){e.push(i.src)});var s={current:i,urls:e},r=jssdk(),c=n.extend({},s,r);a.previewImage(c)}}),i.prototype={constructor:i,imgUpCount:function(){var t=this.opt.maxNum,i=this.opt.par.find(this.opt.item.selector),e=i.length,n=this.opt.action;e>=t?n.hide():n.show(),this.setVal()},setVal:function(){var t=this.opt.par.parent().find(this.opt.input.selector);if(t.length){var i=this.opt.par.find(this.opt.item.selector),e={};i.each(function(t,i){n(i).hasClass("loading_item")||(e[t]=n(i).find("img").attr("url"))});var a=JSON.stringify(e);t.val("{}"===a?"":a),t.change()}},imgUpload:function(){function t(){var s={localId:localIds[i],success:function(a){var s=a.serverId;n.ajax({url:e.opt.url,type:"post",data:{mediaid:s,M_TOKEN:M_TOKEN},dataType:"json",success:function(a){if(2e6==a.retcode){var s='<li><div class="img_up_item" style="background:url(/wechat/accessimg/?url='+a.url+"&M_TOKEN="+M_TOKEN+') center center;background-size:cover;"><a href="javascript:void(0);" class="upload_delete" title="删除"></a><img src="/wechat/accessimg/?url='+a.url+"&M_TOKEN="+M_TOKEN+'" url="'+a.url+'" class="upload_image" /><br></div></li>';n(s).insertBefore(e.opt.action),e.imgUpCount(),++i<localIds.length&&t()}else o(a.msg),++i<localIds.length&&t()},error:function(){o("网络故障，请稍后重试！"),++i<localIds.length&&t()}})},fail:function(){o("上传失败")}};upoptions=n.extend({},s,r),a.uploadImage(upoptions)}if("undefined"==typeof localIds)o("请先选择图片!");else{var i=0,e=this;t()}},imgChoose:function(){var t=this,i={success:function(i){var e=t.opt.maxNum-t.opt.par.find(t.opt.item.selector).length;return i.localIds.length>e?void o("最多可上传"+t.opt.maxNum+"张照片！请重新选择"):(window.localIds=i.localIds,void t.imgUpload())},fail:function(){o("选择图片失败")}},e=n.extend({},i,r);a.chooseImage(e)},imgDel:function(t){t.remove(),this.imgUpCount()}};var r=jssdk();wx.ready(function(){n("body").on("touchend",".img_up_action",function(){s.init();var t=n(this).parents(".img_up_list");new i({maxNum:parseInt(t.attr("data-maxNum")),action:n(this).parent(),par:t,item:n(".img_up_item"),url:"/wechat/upload/"}).imgChoose()}),n("body").on("touchend",".upload_delete",function(){var t=n(this).parents("li"),e=n(this).parents(".img_up_list");new i({maxNum:parseInt(e.attr("data-maxNum")),action:e.find(".img_up_action").parent(),par:e,item:n(".img_up_item"),url:"/wechat/upload/"}).imgDel(t)})}),n("body").off("touchend",".img_up_item img").on("touchend",".img_up_item img",function(t){if(t.stopPropagation(),!n(this).parent().hasClass("loading_item")&&t.target!=n(this).parent().find(".upload_delete")[0]){var i=this.src,e=[],o=n("body").find("img");o.each(function(t,i){e.push(i.src)});var s={current:i,urls:e},r=jssdk(),c=n.extend({},s,r);a.previewImage(c)}});var o=t("alertShow"),c=t("postData"),u=t("fastclick");n("#text").on("blur input",e),n(".ipt_text").on("blur input",e),n("#submit").on("click",function(){if(!this.clicked&&!n(this).hasClass("gray")){var t={content:n("#text").val(),media_ids:n(".imgsIpt").val(),phone:n(".ipt_text").val()};console.log(t),this.clicked=!0;var i=this;t.M_TOKEN=M_TOKEN,c({elm:i,data:t,success:function(t){2e6==t.retcode?o("提交成功",function(){wx&&wx.closeWindow()}):o(t.msg||"网络繁忙")}})}}),u(document.body)});