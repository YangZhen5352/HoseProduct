define("pages/myorder",function(require,exports,module){function addHistory(){ls.getItem("orderArr")||ls.setItem("orderArr","");var e=ls.getItem("orderArr");e.indexOf(keyWords.trim())<0&&(e.length>0?ls.setItem("orderArr",keyWords+","+e):ls.setItem("orderArr",keyWords))}function showHistory(){if($history.removeClass("dn"),!ls.getItem("orderArr"))return void $orderArr.html("");var e=ls.getItem("orderArr").split(","),t="";if(e.length>0){for(var s=0;s<e.length;s++)t+="<p>"+e[s]+"</p>";$orderArr.html(t)}$(".order-arr p").on("click",searchByHistory)}function clearHistory(){alertShow("确定清空历史搜索吗？",2,"取消","确定",function(){},function(){ls.setItem("orderArr",""),showHistory()})}function searchActive(){$iptSearch.css("margin","0 50px"),$(".back-arrow").css("display",""),$("#searchBtn").css("display",""),$(".search-icon").css("left","17px"),$(".search-ipt").css("text-align","left").css("margin-left","0").css("left","35px"),$tapList.addClass("dn"),$scroller.addClass("dn"),$notfound.css("display","none"),$keyWords.off("click focus",searchActive),showHistory()}function inputActive(){""!==$(this).val()?$del.removeClass("dn"):$del.addClass("dn")}function delBtn(){$keyWords.val(""),$del.addClass("dn"),$searchResult.addClass("dn").html(""),$history.removeClass("dn")}function back(){$iptSearch.css("margin","0 15px"),$(".back-arrow").css("display","none"),$("#searchBtn").css("display","none"),$del.addClass("dn"),$history.addClass("dn"),$(".search-icon").css("left",""),$(".search-ipt").css("text-align","").css("margin-left","").css("left",""),$tapList.removeClass("dn"),$scroller.removeClass("dn"),$keyWords.val(""),$keyWords.on("click focus",searchActive),$searchResult.addClass("dn").html(""),$(".search-notfound").css("display","none")}function tapActive(){var e=active;active=tapName[$(this).text()],e!==active&&($($tap[e]).css("color",""),$line.css("left",20*active+"%"),$($tap[active]).css("color","#28a7e1"),tapConInit())}function tapConInit(){var e=active;$.ajax({url:"/wechat/dosearchorder/",type:"post",dataType:"json",data:{orderStatus:e+1,page:1,size:10,time:$("#time").val(),M_TOKEN:M_TOKEN},success:function(t){var s=t.data&&t.data.length;if(console.log(t),0===s||void 0===s)$order.html(""),$scroller.addClass("dn"),$notfound.css("display","");else if(10>s?($(".up").addClass("dn"),console.log(s)):$(".up").removeClass("dn"),$scroller.removeClass("dn"),$notfound.css("display","none"),e===active){var a=[];$.each(t.data,function(e,t){a.push(tpl({id:t.id,auditstate:t.auditstate,code:t.code,loanname:t.loanname,ctime:t.ctime,auditstatename:t.auditstatename,auditcss:t.auditcss}))}),$order.html(a.join(""))}},error:function(){}})}function ajaxSearch(){keyWords=$keyWords.val(),keyWords&&$.ajax({url:"/wechat/dosearchorder/",type:"post",dataType:"json",data:{keyWords:keyWords,time:$("#time").val(),M_TOKEN:M_TOKEN},success:function(e){var t=e.data&&e.data.length;if(0===t||void 0===t)return $history.addClass("dn"),$searchResult.html(""),void $(".search-notfound").css("display","");addHistory(),showHistory(),$(".search-notfound").css("display","none");var s=[];$.each(e.data,function(e,t){s.push(tpl({id:t.id,auditstate:t.auditstate,code:t.code,loanname:t.loanname,ctime:t.ctime,auditstatename:t.auditstatename,auditcss:t.auditcss}))}),$history.addClass("dn"),$searchResult.removeClass("dn").html(s.join(""))}})}function searchByHistory(){$del.removeClass("dn"),console.log(keyWords),keyWords=$(this).text(),$keyWords.val(keyWords),ajaxSearch()}var $=require("Zepto"),alertShow=require("alertShow"),refresh=(require("wechat"),require("refresh")),wx=require("jweixin"),tpl=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="pro_list">\n	<a class="right" href="/wechat/orderdetail/?id='+(null==(__t=id)?"":__t)+'">\n		<ul>\n			<li><span class="left">提交订单时间</span><span class="right">'+(null==(__t=ctime)?"":__t)+'</span></li>\n			<li><span class="left">订单号</span><span class="right">'+(null==(__t=code)?"":__t)+'</span></li>\n			<li><span class="left">借款人</span><span class="right">'+(null==(__t=loanname)?"":__t)+'</span></li>\n			<li><span class="left">订单状态</span><span class=" '+(null==(__t=auditcss)?"":__t)+' ">'+(null==(__t=auditstatename)?"":__t)+'</span></li>	\n		</ul>\n	</a>\n	<i class="icon icon_'+(null==(__t=auditcss)?"":__t)+'"></i>\n</div>\n';return __p},$up=(require("fastclick"),$(".up")),$down=$(".down"),$line=$(".line"),$tap=$(".tap-list li"),$tapList=$(".tap-list"),$back=$(".back-arrow"),$history=$(".history"),$orderArr=$(".order-arr"),$notfound=$(".not-found"),$scroller=$(".scroller-wrap"),$searchBtn=$("#searchBtn"),$keyWords=$("#keyWords"),$del=$(".del"),$order=$(".order"),$searchResult=$(".search-result"),$iptSearch=$(".ipt-searchbox"),tapName={"全部":0,"进行中":1,"待还款":2,"已结清":3,"已失效":4},active=0,keyWords="";0===anyData&&($order.html(""),$scroller.addClass("dn"),$notfound.css("display",""));var ls=window.localStorage;$keyWords.on("click focus",searchActive),$keyWords.on("input",inputActive),$back.on("click",back),$tap.on("tap",tapActive),$(".order-arr p").on("click",searchByHistory),$del.on("click",delBtn),$searchBtn.on("click",ajaxSearch),$(".clear-history").on("click",clearHistory),wx.ready(function(){$(".scroller").height()<window.innerHeight-55||($(".up").css("visibility","visible"),$(".down").css("visibility","visible"),refresh({container:".scroller-wrap",distance:40,click:!0,pullUpAction:function(e){$up.text("加载中...");var t=$(".order"),s=(t.index(),this);this.ii=this.ii||2,$.ajax({url:"/wechat/dosearchorder/",type:"post",dataType:"json",data:{orderStatus:active+1,page:s.ii,size:10,time:$("#time").val(),M_TOKEN:M_TOKEN},success:function(a){if(!a.data.length)return void $up.text("没有了");var r=[];$.each(a.data,function(e,t){r.push(tpl({id:t.id,auditstate:t.auditstate,code:t.code,loanname:t.loanname,ctime:t.ctime,auditstatename:t.auditstatename,auditcss:t.auditcss}))}),t.append(r.join("")),e.refresh(),s.ii++,$up.text("上拉加载")},error:function(){$up.text("上拉加载")},complete:function(){}})},pullDownAction:function(e){$down.text("加载中...");{var t=$(".order");t.index()}$.ajax({url:"/wechat/dosearchorder/",type:"post",dataType:"json",data:{orderStatus:active+1,page:1,size:10,M_TOKEN:M_TOKEN},success:function(e){if(!e.data.length)return void $up.text("没有了");var s=[];$.each(e.data,function(e,t){s.push(tpl({id:t.id,auditstate:t.auditstate,code:t.code,loanname:t.loanname,ctime:t.ctime,auditstatename:t.auditstatename,auditcss:t.auditcss}))}),t.html(s.join(""))},complete:function(){$down.text("下拉刷新"),e.refresh()}})}}))})});